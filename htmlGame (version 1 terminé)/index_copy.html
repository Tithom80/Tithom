<html>
    <script>
            // début du code isolé
            {
                document.getElementById('theCanvas');

                let context2D = document.getElementById('theCanvas').getContext('2d');
                //loader d image

                function loadImagePromise(url) {
                            return new Promise((resolve, reject) => {
                                let image = new Image();
                                image.onload = function () { resolve(image) };
                                const msg = 'Unable to load image at ' + url;
                                image.onerror = function () { reject(new Error(msg)) };
                                image.src = url;
                            })
                        }
                const imageList = [
                    loadImagePromise('1.png'),
                    loadImagePromise('2.png'),
                    loadImagePromise('3.png'),
                    loadImagePromise('4.png')
                    ];
                Promise.all(imageList)
                    .then(function () { alert("all are loaded"); })
                    .catch(function (error) { alert("not loaded " + error); });
                    //loader image fin


                let requestAnimId;
                let initialisation = function () {
                    // le code de l'initialisation
                    // appel de la fonction afficherRectangleBleu au chargement de la page
                    window.onload = afficherRectangleBleu;
                    // premier appel de principale au rafraichissement de la page 
                    requestAnimId = window.requestAnimationFrame(principale);
                }
                let principale = function () {
                    // le code du jeu
                        function afficherRectangleBleu() {
                        let context2D = document.getElementById('theCanvas').getContext('2d');
                        // définition de la couleur du tracé
                        context2D.strokeStyle = "#0000FF";
                        // dessin du rectangle
                        context2D.rect(200, 200, 100, 25);
                        // affichage dans le canvas
                        context2D.stroke();
                    } 
                    var canvas = document.querySelector('canvas');
                    var ctx = canvas.getContext('2d');
                    ctx.fillStyle = 'green';
                    ctx.fillRect(10, 10, 100, 100);

                    // rappel de principale au prochain rafraichissement de la page
                    requestAnimId = window.requestAnimationFrame(principale);
                }
                // appel de la fonction initialisation au chargement de la page
                window.onload = initialisation;
            }
            // fin du code isolé
  function afficherRectangleBleu() {
        let context2D = document.getElementById('theCanvas').getContext('2d') ;
        // définition de la couleur du tracé
        context2D.strokeStyle = "#0000FF";
        // dessin du rectangle
        context2D.rect(200, 200, 100, 25);
        // affichage dans le canvas
        context2D.stroke();
  }
  // appel de la fonction afficherRectangleBleu au chargement de la page
  window.onload = afficherRectangleBleu;
 </script>
<body>
    <canvas id="theCanvas" width="800" height="600" style="border: 1px solid #000000;">
        Votre navigateur ne supporte pas le Canvas HTML5
    </canvas>

</body>

</html>
